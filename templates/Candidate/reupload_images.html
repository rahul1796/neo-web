<link href="static/assets/libs/bootstrap-colorpicker/bootstrap-colorpicker.min.css" rel="stylesheet" type="text/css" />
<link href="static/assets/libs/clockpicker/bootstrap-clockpicker.min.css" rel="stylesheet" type="text/css" />
<link href="static/assets/libs/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css" />

<script type="text/javascript">
const months = ["Jan", "Feb", "Mar","Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
const months_no = ["01", "02", "03","04", "05", "06", "07", "08", "09", "10", "11", "12"];
var Candidates = {};
    $(document).ready(function(){
        $('.dropdown-search-filter').select2();
        $(".date-picker").flatpickr();             
        $(".time-picker").flatpickr({
            enableTime: !0,
            noCalendar: !0,
            dateFormat: "H:i",
            time_24hr:  !0
            });
        var candidate_id = '{{candidate_id}}'
        var candidate_stage_id = '{{candidate_stage_id}}'
        if(candidate_id !=0)
        {
            if(candidate_stage_id==2){
                $('#form1').attr('action', '/registration');
                $('#div_Signed_MoU').hide();
                $('#div_Age_proof').hide();
                $('#div_Educational_qualification_Proof').hide();
                $('#div_Bank_Account_Copy').hide();
            }
            else if (candidate_stage_id==3){
                $('#form1').attr('action', '/enrollment');
                $('#div_Income_Certificate').hide();
                $('#div_Education_Mark_Sheet').hide();
                $('#div_Identity_Image').hide();
                $('#div_Aadhar_Image').hide();
                $('#div_candidate_photo').hide();
            }
            download_images();
        }
    });
    function UploadFileData_s3(file,file_name)
    {
        var fileExtension = ['xlsx'];
        var s3_path="neo_app/images/" + filename_prefix;
        if (fileExtension.includes(file_name.split('.').pop().toLowerCase())){
            s3_path ="bulk_upload/candidate/registration/" + filename_prefix;
        }
        var file_path=$('#hdn_AWS_S3_path').val()+ s3_path + file_name;
        var api_url=$('#hdn_COL_url').val() + "s3_signature?file_name="+file_path+"&file_type="+file.type;
        
        var xhr = new XMLHttpRequest();
        xhr.open("GET",api_url );
            xhr.onreadystatechange = function(){
                if(xhr.readyState === 4){
                if(xhr.status === 200){
                    var response = JSON.parse(xhr.responseText);
                    console.log(response);
                    uploadFileToS3(file, response.data, response.url);
                }
                else{
                    alert("Could not get signed URL.");
                }
                }
            };
            xhr.send();
    }
    function uploadFileToS3(file, s3Data, url){
        var xhr = new XMLHttpRequest();
        xhr.open("POST", s3Data.url);

        var postData = new FormData();
        for(key in s3Data.fields){
            postData.append(key, s3Data.fields[key]);
        }
        postData.append('file', file);

        xhr.onreadystatechange = function() {
            if(xhr.readyState === 4){
            if(xhr.status === 200 || xhr.status === 204){
                var response = xhr;
                console.log(response);
                //UploadFileToProcess();
            }
            else{
                alert("Could not upload file to s3.");
            }
        }
        };
        xhr.send(postData);
    }
    function download_images()
    {
        var URL=$('#hdn_web_url').val()+ "/AllCandidateImages"
        $.ajax({
        type:"GET",
        url:URL,
        async:false,        
        beforeSend:function(x){ if(x && x.overrideMimeType) { x.overrideMimeType("application/json;charset=UTF-8"); } },
        datatype:"json",
        data:{
            "user_id": $('#hdn_home_user_id').val(),
            "user_role_id" : $('#hdn_home_user_role_id').val(),
            "candidate_id" : '{{candidate_id}}'
        },

        success: function (data){
            //console.log(data);
            if(data.Candidate != null)
            {  
                if (data.Candidate.Candidate_Photo!=''){
                    var s = document.getElementById('ur_candidate_photo')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Candidate_Photo;
                }
                if (data.Candidate.Aadhar_Image_Name!=''){
                    var s = document.getElementById('ur_Aadhar_Image')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Aadhar_Image_Name;
                }
                if (data.Candidate.Identity_Image_Name!=''){
                    var s = document.getElementById('ur_Identity_Image')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Identity_Image_Name;
                }
                if (data.Candidate.Educational_Marksheet!=''){
                    var s = document.getElementById('ur_Education_Mark_Sheet')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Educational_Marksheet;
                }
                if (data.Candidate.Income_Certificate!=''){
                    var s = document.getElementById('ur_Income_Certificate')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Income_Certificate;
                }
                if (data.Candidate.Bank_Account_Image_Name!=''){
                    var s = document.getElementById('ur_Bank_Account_Copy')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Bank_Account_Image_Name;
                }
                if (data.Candidate.Educational_Qualification!=''){
                    var s = document.getElementById('ur_Educational_qualification_Proof')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Educational_Qualification;
                }
                if (data.Candidate.Age_Proof!=''){
                    var s = document.getElementById('ur_Age_proof')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Age_Proof;
                }
                if (data.Candidate.Signed_Mou!=''){
                    var s = document.getElementById('ur_Signed_MoU')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Signed_Mou;
                }
            }
        },
        error:function(err)
        {
            alert('Error while loading BU! Please try again');
            return false;
        }
    });
    return false;
    }

    function Upload_image(id){
        var validImageTypes = ['image/gif', 'image/jpeg', 'image/png'];
        var filename_prefix = $('#hdn_home_user_id').val() + '_' + Date.now() + '_'
        var file = document.getElementById('myFile'+id).files[0]
        if (!validImageTypes.includes(file['type'])){
            console.log(1);
        }
        else if(1==1){
            console.log(2);
        }
        else{
            console.log(3);
        }


        var URL=$('#hdn_web_url').val()+ "/AllCandidateImages"
        $.ajax({
        type:"GET",
        url:URL,
        async:false,        
        beforeSend:function(x){ if(x && x.overrideMimeType) { x.overrideMimeType("application/json;charset=UTF-8"); } },
        datatype:"json",
        data:{
            "user_id": $('#hdn_home_user_id').val(),
            "user_role_id" : $('#hdn_home_user_role_id').val(),
            "id" : id,


        },
        success: function (data){
            if(data.Success != null)
            {  
                if (data.Candidate.Candidate_Photo!=''){
                    var s = document.getElementById('ur_candidate_photo')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Candidate_Photo;
                }
                if (data.Candidate.Aadhar_Image_Name!=''){
                    var s = document.getElementById('ur_Aadhar_Image')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Aadhar_Image_Name;
                }
                if (data.Candidate.Identity_Image_Name!=''){
                    var s = document.getElementById('ur_Identity_Image')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Identity_Image_Name;
                }
                if (data.Candidate.Educational_Marksheet!=''){
                    var s = document.getElementById('ur_Education_Mark_Sheet')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Educational_Marksheet;
                }
                if (data.Candidate.Income_Certificate!=''){
                    var s = document.getElementById('ur_Income_Certificate')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Income_Certificate;
                }
                if (data.Candidate.Bank_Account_Image_Name!=''){
                    var s = document.getElementById('ur_Bank_Account_Copy')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Bank_Account_Image_Name;
                }
                if (data.Candidate.Educational_Qualification!=''){
                    var s = document.getElementById('ur_Educational_qualification_Proof')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Educational_Qualification;
                }
                if (data.Candidate.Age_Proof!=''){
                    var s = document.getElementById('ur_Age_proof')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Age_Proof;
                }
                if (data.Candidate.Signed_Mou!=''){
                    var s = document.getElementById('ur_Signed_MoU')
                    s.src = $('#hdn_web_url').val() + '/GetDocumentForExcel_S3_certiplate?image_name='+data.Candidate.Signed_Mou;
                }
            }
        },
        error:function(err)
        {
            alert('Error while loading BU! Please try again');
            return false;
        }
    });
    return false;
    
    download_images();

    }
</script>

<div class="container-fluid">
    <form action="/" method="GET" id='form1'>
    <div class="row">
        <div class="col-12">
            <div class="page-title-box">
                <div class="page-title-right">
                    <ol class="breadcrumb m-0">
                        <li class="breadcrumb-item"><a href="javascript: void(0);">LN</a></li>
                        <li class="breadcrumb-item active">Reupload Images</li>
                    </ol>
                </div>
                <h4 class="page-title">Image</h4>
            </div>
        </div>
    </div>     
    <!-- end page title --> 
    
    <div id="get" class="row">
        <div class="col-12">
            <div class="card-box">
                <form id="demo-form" data-parsley-validate="">

                    <div class="form-group" id="div_candidate_photo">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="ur_candidate_photo">Candidate Photo</label>
                            </div>
                            <div class="col-lg-2">
                                <img id="ur_candidate_photo" name="ur_candidate_photo" src="" alt="Candidate Photo" style="width:128px;height:128px;">
                            </div>
                            <div class="col-lg-6">
                                <input style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;" type="file" id="myFile1" name="filename">
                                <button  type="button" class="btn btn-success waves-effect waves-light" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;" onclick="Upload_image(1)" id="btnUpload">Upload</button>
                            </div>
                        </div>
                    </div> 
                    <div class="form-group" id="div_Aadhar_Image">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="ur_Aadhar_Image">Aadhar Image</label>
                            </div>
                            <div class="col-lg-2">
                                <img id="ur_Aadhar_Image" name="ur_Aadhar_Image" src="" alt="Aadhar Image" style="width:128px;height:128px;">
                            </div>
                            <div class="col-lg-6">
                                <input type="file" id="myFile2" name="filename" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;">
                                <button  type="button" class="btn btn-success waves-effect waves-light" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;" onclick="Upload_image(2)" id="btnUpload">Upload</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="div_Identity_Image">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="ur_Identity_Image">Identity Image</label>
                            </div>
                            <div class="col-lg-2">
                                <img id="ur_Identity_Image" name="ur_Identity_Image" src="" alt="Identity Image" style="width:128px;height:128px;">
                            </div>
                            <div class="col-lg-6">
                                <input type="file" id="myFile3" name="filename" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;">
                                <button  type="button" class="btn btn-success waves-effect waves-light" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;" onclick="Upload_image(3)" id="btnUpload">Upload</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="div_Education_Mark_Sheet">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="ur_Education_Mark_Sheet">Education Mark Sheet</label>
                            </div>
                            <div class="col-lg-2">
                                <img id="ur_Education_Mark_Sheet" name="ur_Education_Mark_Sheet" src="" alt="Education Mark Sheet" style="width:128px;height:128px;">
                            </div>
                            <div class="col-lg-6">
                                <input type="file" id="myFile4" name="filename" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;">
                                <button  type="button" class="btn btn-success waves-effect waves-light" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;" onclick="Upload_image(4)" id="btnUpload">Upload</button>
                            </div>
                        </div>
                    </div> 
                    <div class="form-group" id="div_Income_Certificate">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="ur_Income_Certificate">Income Certificate</label>
                            </div>
                            <div class="col-lg-2">
                                <img id="ur_Income_Certificate" name="ur_Income_Certificate" src="" alt="Income Certificate" style="width:128px;height:128px;">
                            </div>
                            <div class="col-lg-6">
                                <input type="file" id="myFile5" name="filename" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;">
                                <button  type="button" class="btn btn-success waves-effect waves-light" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;" onclick="Upload_image(5)" id="btnUpload">Upload</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="div_Bank_Account_Copy">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="ur_Bank_Account_Copy">Bank Account Copy</label>
                            </div>
                            <div class="col-lg-2">
                                <img id="ur_Bank_Account_Copy" name="ur_Bank_Account_Copy" src="" alt="Bank Account Copy" style="width:128px;height:128px;">
                            </div>
                            <div class="col-lg-6">
                                <input type="file" id="myFile6" name="filename" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;">
                                <button  type="button" class="btn btn-success waves-effect waves-light" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;" onclick="Upload_image(6)" id="btnUpload">Upload</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="div_Educational_qualification_Proof">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="ur_Educational_qualification_Proof">Educational qualification Proof</label>
                            </div>
                            <div class="col-lg-2">
                                <img id="ur_Educational_qualification_Proof" name="ur_Educational_qualification_Proof" src="" alt="Educational qualification Proof" style="width:128px;height:128px;">
                            </div>
                            <div class="col-lg-6">
                                <input type="file" id="myFile7" name="filename" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;">
                                <button  type="button" class="btn btn-success waves-effect waves-light" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;" onclick="Upload_image(7)" id="btnUpload">Upload</button>
                            </div>
                        </div>
                    </div> 
                    <div class="form-group" id="div_Age_proof">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="ur_Age_proof">Age proof</label>
                            </div>
                            <div class="col-lg-2">
                                <img id="ur_Age_proof" name="ur_Age_proof" src="" alt="Age proof" style="width:128px;height:128px;">
                            </div>
                            <div class="col-lg-6">
                                <input type="file" id="myFile8" name="filename" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;">
                                <button  type="button" class="btn btn-success waves-effect waves-light" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;" onclick="Upload_image(8)" id="btnUpload">Upload</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="div_Signed_MoU">
                        <div class="row">
                            <div class="col-lg-4">
                                <label for="ur_Signed_MoU">Signed MoU</label>
                            </div>
                            <div class="col-lg-2">
                                <img id="ur_Signed_MoU" name="ur_Signed_MoU" src="" alt="Signed MoU" style="width:128px;height:128px;">
                            </div>
                            <div class="col-lg-6">
                                <input type="file" id="myFile9" name="filename" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;">
                                <button  type="button" class="btn btn-success waves-effect waves-light" style="float: left; color:white;font-weight:bold;cursor:pointer;margin-top:30px;" onclick="Upload_image(9)" id="btnUpload">Upload</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-0">
                        <button class="btn btn-primary" type="submit">Save</button>
                    </div>

                </form>
            </div> <!-- end card-box-->
        </div> <!-- end col-->
    </div>
    <!-- end row-->

</form>
</div> <!-- end container -->
    <!-- end wrapper -->

<script src="static/assets/libs/bootstrap-colorpicker/bootstrap-colorpicker.min.js"></script>
<script src="static/assets/libs/clockpicker/bootstrap-clockpicker.min.js"></script>
<script src="static/assets/libs/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>

<script src="static/assets/libs/datatables/jquery.dataTables.min.js"></script>
<script src="static/assets/libs/datatables/dataTables.bootstrap4.js"></script>
<script src="static/assets/libs/datatables/dataTables.responsive.min.js"></script>
<script src="static/assets/libs/datatables/responsive.bootstrap4.min.js"></script>
<script src="static/assets/libs/datatables/dataTables.buttons.min.js"></script>
<script src="static/assets/libs/datatables/buttons.bootstrap4.min.js"></script>
<script src="static/assets/libs/datatables/buttons.html5.min.js"></script>
<script src="static/assets/libs/datatables/buttons.flash.min.js"></script>
<script src="static/assets/libs/datatables/buttons.print.min.js"></script>
<script src="static/assets/libs/datatables/dataTables.keyTable.min.js"></script>
<script src="static/assets/libs/datatables/dataTables.select.min.js"></script> 